          <!-- Start of LINKTYPE_CAN_SOCKETCAN section -->
          <div class="post">
            <h2 class="title">
                <a name="intro">LINKTYPE_CAN_SOCKETCAN</a>
            </h2>
            <div class="entry">
                <h3>Packet structure</h3>
<pre>
+---------------------------+
|      CAN ID and flags     |
|         (4 Octets)        |
+---------------------------+
|    Frame payload length   |
|         (1 Octet)         |
+---------------------------+
|          Padding          |
|         (1 Octet)         |
+---------------------------+
|      Reserved/Padding     |
|         (1 Octet)         |
+---------------------------+
|      Reserved/Padding     |
|         (1 Octet)         |
+---------------------------+
|           Payload         |
.                           .
.                           .
.                           .
</pre>

                <h3>Description</h3>
<p>
The field containing the CAN ID and flags is in network byte order
(big-endian).  The bottom 29 bits contain the CAN ID of the frame.  The
remaining bits are:
</p>
<ul>
<li>0x20000000 - set if the frame is an error message rather than a data
frame.
<li>0x40000000 - set if the frame is a remote transmission request
frame.
<li>0x80000000 - set if the frame is an extended 29-bit frame rather
than a standard 11-bit frame.
</ul>

<p>
The frame payload length indicates the number of bytes of payload.
</p>

<p>
For a data frame, the payload is the data field of the CAN or CAN FD
packet.
<p>

<p>
For an error message, the payload is always 8 bytes.  The lower bits of
the CAN ID field contain an error class value, with bits specified by
the first set of CAN_ERR_ values in <a
href="https://github.com/torvalds/linux/blob/master/include/uapi/linux/can/error.h">the
Linux uapi/can/error.h header</a>.  The bytes in the payload are:
<ul>
<li>first byte - if arbitration was lost, the bit number in the bitstream in which it was lost;
otherwise 0. 
<li>second byte - the error status of the CAN controller, with bits
specified by the CAN_ERR_CRTL_ bits in the Linux uapi/can/error.h
header.
<li>third byte - flags indicating a CAN protocol error type, with bits
specified by the CAN_ERR_PROT_ bits in the Linux uapi/can/error.h
header.
<li>fourth byte - flags indicating a CAN protocol error location, with
bits specified by the CAN_ERR_LOC_ bits in the Linux uapi/can/error.h
header.
<li>fifth byte - the error status of the CAN transceiver, with values
specified by the CAN_ERR_TRX_ values in the Linux uapi/can/error.h
header.
<li>sixth, seventh, and eighth bytes - controller-specific additional
information.
</ul>
</p>

<p>
(XXX - what about remote transmission requests? As I read the spec, it
indicates that they have no data.)
</p>
            </div>
            <!-- End of LINKTYPE_CAN_SOCKETCAN section -->
          </div>
